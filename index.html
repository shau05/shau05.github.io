<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button style="margin:7% 15%;font-size:2rem;" onclick="initiatePayment()">Pay</button>
    <script>
        function initPaymentRequest() {
            if (!window.PaymentRequest) {
                return null;
            }
            let url = "https://mercury-stg.phonepe.com/transact/mintent?token=YTI5ZDhmNWZkY2Y3MzNjNTUzZmRmN2FkMGU0NjY4YTI2ODMxNzVhOWM5MWE5MGZiYWMwYjAzODliNmE1MDFlMWQyMTNiNDE1NjJmZjk1MzVjNTZlMzdhZDc0YWViNzU5Mzg0Yzc3MGQxYjNkNWU6ZWQ5ZGE3MGIzNDI1ZTUzMDBlNzZhMmU5ODFkZTAyZmM";
            let supportedInstruments = [{
                supportedMethods: "https://mercury-stg.phonepe.com/transact/pay",
                data: {
                    url
                }
            }];
            const details = {
                total: {
                    label: "total",
                    amount: {
                        currency: "INR",
                        value: "100",
                    }
                }
            }
            let request = new PaymentRequest(supportedInstruments, details);
            return request;
        }
        let success = (success_) => {
            console.log("success " + success_);
        }
        let failure = (failure_) => {
            console.log("failed " + failure_);
        }

        let handleResponse = (response) => {
            console.log(response);
        }

        let initiatePayment = async () => {
            let request = initPaymentRequest();
            if (request == null) {
                failure("browser does not support payment request api");
                return;
            }
            request.canMakePayment().then((result) => {
                console.log(result);
                if (result == true) {
                    success("can make payment");
                    request.show().then((paymentResponse) => {
                        paymentResponse.complete("success");
                        handleResponse(paymentResponse);
                    }).catch((err) => {
                        failure(err);
                    });
                } else {
                    failure("cannot make payment");
                }
            }).catch((err) => {
                failure(err);
            });
        }
    </script>
</body>

</html>